{% extends "base.html" %}
{% load static %}
{% block title %}{{ recipe.recipe_name }}{% endblock %}
{% block content %}

{% load crispy_forms_tags %}

<!-- header start -->
<header class="text-white header">
    <div class="container">
        <div class="row">

            <!-- display the name, author and the date of creation of the current recipe -->
            <div class="col-12 my-5">
                <h1 class="cursive">{{ recipe.recipe_name }}</h1>
                <h5>added by: {{ recipe.author }}</h5>
                <h5>{{ date_added }}</h5>
            </div>
        </div>
    </div>
</header>
<!-- header end -->

<div class="container my-4">
    <div class="row">
        <div class="col-12 text-center">

            <!-- if the user is logged in they can save and unsave a recipe -->
            {% if user.is_authenticated %}
            <form class="d-inline" action="{% url 'saved' recipe.slug %}" method="POST">
                {% csrf_token %}
                {% if saved %}
                <button class="btn big" type="submit" name="blogpost_id" value="{{ recipe.slug }}">
                    <i class="fa-sharp fa-solid fa-bookmark "></i>
                </button>
                {% else %}
                <button class="btn big" type="submit" name="blogpost_id" value="{{ recipe.slug }}">
                    <i class="fa-sharp fa-regular fa-bookmark"></i>
                </button>
                {% endif %}
            </form>
            {% endif %}

            <!-- if the user is the author of the recipe, display an edit and a delete icon -->
            {% if user == recipe.author %}
            <a class="a-reverse" href="{% url 'update_recipe' recipe.slug %}">
                <button class="btn big elara mt-2" type="submit"><i class="fa-solid fa-pencil"></i></button>
            </a>
            <a class="a-reverse" href="{% url 'delete_recipe' recipe.slug %}">
                <button class="btn big elara mt-2" type="submit"><i class="fa-solid fa-trash-can"></i></button>
            </a>
            {% endif %}

        </div>
    </div>
</div>


<!-- main section start -->
<section>
    <div class="container">

        <!-- first row start -->
        <div class="row white shadow mb-4">

            <!-- recipe image -->
            <div class=" col-12 col-md-5 col-lg-4 p-2">
                <img class="img-fluid" src="https://codeinstitute.s3.amazonaws.com/fullstack/blog/default.jpg" alt="">
            </div>

            <!-- recipe details -->
            <div class="col-12 col-md-5 col-lg-8 p-4">
                <h3>Details:</h3>
                <ul class="list-unstyled">
                    <li>
                        <b>
                            Perfect for:
                        </b> {{ recipe.get_type_display }}
                    </li>
                    <li>
                        <b>
                            prep time:
                        </b>
                        {{ recipe.get_prep_time_display }}
                    </li>
                    <li>
                        <b>
                            cooking time:
                        </b>
                        {{ recipe.get_cooking_time_display }}
                    </li>
                    <li>
                        <b>
                            difficulty:
                        </b>
                        {{ recipe.get_difficulty_display }}
                    </li>
                    <li>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar"
                                style="width: {{ recipe.difficulty }}%;" aria-valuenow="{{ recipe.difficulty }}"
                                aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <!-- first row end -->


        <!-- second row start / recipe ingredients -->
        <div class="row white shadow mb-4">
            <div class="col-12 p-4">
                <div>
                    <h3>Ingredients:</h3>{{ recipe.ingredients|safe }}
                </div>
            </div>
        </div>
        <!-- second row end  -->


        <!-- third row start / recipe method -->
        <div class="row white shadow mb-4">
            <div class="col-12 p-4">
                <div>
                    <h3>Method:</h3>{{ recipe.method|safe }}
                </div>
            </div>
        </div>
        <!-- third row end -->


        <!-- comment section start -->
        <div class="row white shadow mb-4">
            <div class="col-md-8 p-4">
                <h3>Comments:</h3>
                <div>

                    <!-- list comments -->
                    {% for comment in comments %}
                    <div class="comments">
                        <p class="font-weight-bold">
                            {{ comment.name }}

                            <span class="text-muted">
                                {{ comment.created_on }}
                            </span>

                            <span>
                                <!-- if the existing comment belongs to the current user -->
                                {% if user.username == comment.name %}

                                <!-- edit comment -->

                                <a class="a-reverse" href="{% url 'edit_comment' comment.id %}">
                                    <i class="fa-solid fa-pencil"></i>
                                </a>

                                <!-- delete comment -->
                                <a class="a-reverse" href="{% url 'delete_comment' comment.id %}">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>


                                {% endif %}
                            </span>
                        </p>

                        {{ comment.body | linebreaks }}

                        <hr>
                    </div>

                    <!-- if there are no comments yet -->
                    {% empty %}

                    <div class="p-5 d-flex align-items-center justify-content-center">
                        <h5 class="text-center text-muted">Be the first to comment! &#128578;</h5>
                    </div>

                    {% endfor %}
                </div>
            </div>


            <!-- comment form -->
            <div class="col-md-4 p-4">
                <div>


                    <!-- if a user is logged in display the comment form -->
                    {% if user.is_authenticated %}

                    <h3>Leave a comment:</h3>
                    <p>Posting as: {{ user.username }}</p>
                    <form method="POST">
                        {{ comment_form | crispy }}
                        {% csrf_token %}
                        <button type="submit" class="btn elara mt-2">Submit</button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- comment section end -->

    </div>
</section>
<!-- main section end -->
{%endblock%}